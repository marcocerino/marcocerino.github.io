<!DOCTYPE html>
<html>
<head>
  <title>Accelerometer Example | Generic Sensor API | mobiForge</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Ruadhan O'Donoghue">
  <meta charset="UTF-8">
</head>
<body>


  <h1>Accelerometer raw data</h1>
  <div id="status">No data</div>

  <script>
    let status = document.getElementById('status');
    if ( 'Accelerometer' in window ) {
      let sensor = new Accelerometer({frequency: 1});
      sensor.addEventListener('reading', function(e) {
        status.innerHTML = 'x: ' + e.target.x + '<br> y: ' + e.target.y + '<br> z: ' + e.target.z;
      });
      sensor.start();
    }
    else status.innerHTML = 'Accelerometer not supported';
  </script>



  <h1>Linear Accelerometer raw data</h1>
  <div id="lad">No data</div>
  <div id="k"> No k</div>
  <div id="stat"> Wait for status</div>
  <script>
    let lad = document.getElementById('lad');
    let k = document.getElementById('k');
    let stat = document.getElementById('stat');
    if ( 'LinearAccelerationSensor' in window ) {
      var win = 4;
      var x_array = [];
      var y_array = [];
      var z_array = [];
      var i = 0;

      let las = new LinearAccelerationSensor({frequency: 1});
      las.addEventListener('reading', function(la) {
        lad.innerHTML = 'x: ' + la.target.x + '<br> y: ' + la.target.y + '<br> z: ' + la.target.z;
        console.log('x: ' + la.target.x + '<br> y: ' + la.target.y + '<br> z: ' + la.target.z);
        if(i<win){
          x_array[i] = Math.abs(la.target.x);
          y_array[i] = Math.abs(la.target.y);
          z_array[i] = Math.abs(la.target.z);
          console.log("i:"+i);
          i++;
        }else{
          var j;
          
          //l_sma = 1/win * sum(x_i+y_i+z_i)
          var l_sma = 0;
          for(j=0; j<win; j++){
            l_sma += x_array[j] + y_array[j] + z_array[j]
          }
          l_sma /= win;


          var sosd=0;
          //sosd = (sum(x_i+y_i+z_i - l_sma)^2 / win)^1/2
          for(j=0; j<win; j++){
            sosd += Math.pow(x_array[j] + y_array[j] + z_array[j] - l_sma,2);
          }
          sosd /= win;
          sosd = Math.sqrt(sosd);
          k.innerHTML = "standard deviation: " + sosd;


          if(k<0.5){
            stat.innerHTML = "Still";
          }
          else{
            stat.innerHTML = "walking";
          }

          i=0;

          x_array[i] = Math.abs(la.target.x);
          y_array[i] = Math.abs(la.target.y);
          z_array[i] = Math.abs(la.target.z);
        }
      });
      las.start();
    }
    else lad.innerHTML = 'Linear Accelerometer not supported';
  </script>
  
  






  <h1>Gravity Accelerometer raw data</h1>
  <div id="gad">No data</div>
  <script>
    let gad = document.getElementById('gad');
    if ( 'GravitySensor' in window ) {
      let gas = new GravitySensor();
      gas.addEventListener('reading', function(g) {
        gad.innerHTML = 'x: ' + g.target.x + '<br> y: ' + g.target.y + '<br> z: ' + g.target.z;
      });
      gas.start();
    }
    else gad.innerHTML = 'Gravity sensor not supported';
  </script>

</body>
</html>
